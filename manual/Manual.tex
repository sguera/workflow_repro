% AEJ-Article.tex for AEA last revised 22 June 2011
\documentclass[AEJ]{AEA}

% The mathtime package uses a Times font instead of Computer Modern.
% Uncomment the line below if you wish to use the mathtime package:
%\usepackage[cmbold]{mathtime}
% Note that miktex, by default, configures the mathtime package to use commercial fonts
% which you may not have. If you would like to use mathtime but you are seeing error
% messages about missing fonts (mtex.pfb, mtsy.pfb, or rmtmi.pfb) then please see
% the technical support document at http://www.aeaweb.org/templates/technical_support.pdf
% for instructions on fixing this problem.

% Note: you may use either harvard or natbib (but not both) to provide a wider
% variety of citation commands than latex supports natively. See below.

% Uncomment the next line to use the natbib package with bibtex 
%\usepackage{natbib}

% Uncomment the next line to use the harvard package with bibtex
\usepackage[abbr]{harvard}
\usepackage{dirtree}
\usepackage{listings}

% This command determines the leading (vertical space between lines) in draft mode
% with 1.5 corresponding to "double" spacing.
\draftSpacing{1.5}

\begin{document}

\title{Manual: Automated Stencil Compilers Comparison}
\shortTitle{Manual}
\author{Gsponer S., Guerrera D. and Maffia A.}
\date{\today}


\begin{abstract}

\end{abstract}

\maketitle

In this document is given a overview over the structure of this little framework and how to use it. 

\section{General Structure}
The root directory (\$BENCHROOT) contains three folders:

\dirtree{%
.1 \$BENCHROOT.
.2 StencilCompilers.
.3 installAll.sh.
.3 <CompilerName>.
.4 install<CompilerName>.sh.
.2 wave.
.3 cleanAll.sh.
.3 runAll.sh.
.3 gatheringOutputs.sh.
.3 <CompilterName>.
.4 run.
.4 output.
.4 src.
.2 workflow\_outputs.
.2 manual.
.2 workflow.sh.
.2 SetupEnv.sh.
}

\subsection{StencilCompilers}
This folder contains all the compilers. The shell script \emph{installAll.sh} call the corresponding \emph{installCompiler.sh} in the sub folders. This scripts downloads the source, extract it and compile the files.  

\subsection{wave}
Every stencil compiler needs its own prepared code for the comparison. The wave directory contains prepared code for Patus, Pochoir, Pluto, Halide and a naive approach. For each compiler the structure in the sub folder is the same and should be self explaining. Additionally to the compiler specific files some scripts are also provided.\\
\begin{itemize}
	\item runAll.sh: Compiles the stencil with each compiler and run it for fixed number of threads. 
	\item cleanAll.sh: Cleans up the sub folders from the last compilation. 
	\item geatheringOutputs.sh: Collects the output of the different compilers and arrange them in the result.dat file.
\end{itemize}

\subsection{workflow\_outputs}
In this folder will be stored the graphs generated by the execution of the workflow, showing comparison among compilers.

\subsection{manual}
In the manual folder all files for this document are stored.

\section{Usage}
There are two ways to use the workflow: a fully automated and a step-by-step one.
\subsection{Fully automated usage}
\begin{lstlisting}[frame=single,language=bash]
  $ ./workflow.sh run|install
\end{lstlisting}

You can use this command to install the compilers or automatically run the tests. In both cases you can specify one or more compilers to be installed or executed. At the end of its execution a graph will be produced and placed into the  \emph{workflow\_outputs} folder.
\subsection{Step-by-step usage}
First thing we need to do is source the SetupEnv.sh file. This set some environment variable for all the shell scripts like the root directory.

\begin{lstlisting}[frame=single,language=bash]
  $ source SetupEnv
\end{lstlisting}

If the compilers are not installed yet switch to the \emph{StencilCompilers} folder and run the \emph{installAll.sh} script. 
\begin{lstlisting}[frame=single,language=bash]
  $ cd StencilCompilers
  $ ./installAll.sh 
\end{lstlisting}

It is also possible to run the script only for a specific compiler. To achieve this simple give the name of the compiler as argument.
\\
Each compiler comes with its own dependencies. At the end of this document I will provide a not final list for each compiler. 
\\
After installing all the compilers we can begin to run the comparison. For this change to the wave folder and execute the \emph{runAll.sh}.

\begin{lstlisting}[frame=single,language=bash]
  $ cd ../wave
  $ ./runAll.sh
\end{lstlisting}

This step will take some time since it actually run the wave stencil with all the compiler for different number of threads. Per default this runs the stencil for 1, 2, 4, 8, 16 threads but this can be changed in the \emph{SetupEnv.sh} file.
\\
When the computation is finished the \emph{gatheringOutputs.sh} script can be executed which creates the result.dat file containing all the outputs. This file can afterwards be plotted with the \emph{gnuplot.gp} file.

\begin{lstlisting}[frame=single,language=bash]
  $ ./gatheringOutputs.sh
  $ gnuplot gnuplot.gp --persist
\end{lstlisting}

After this step a plot sorted by number of threads shows up.
\newpage
\section{Dependencies}
\subsection{General}
\begin{itemize}
	\item wget
	\item Make
\end{itemize}

\subsection{Patus}
\begin{itemize}
	\item Java 7 or newer
	\item Maxima
	\item gcc
\end{itemize}
\subsection{Pochoir}

\begin{itemize}
	\item Intel C++ Compiler version 12.0.0 or later with Cilk Plus extension, up to v 13.0.0
	\item Glasgow Haskell Compilation System version 6.12.1 or later
	\item Parsec-2.1.0.1 or later
\end{itemize}
\subsection{Pluto}

\begin{itemize}
	\item gmp (GNU multiple precision arithmetic library)
\end{itemize}

\subsection{Halide}

\begin{itemize}
	\item llvm 3.2 or higher
	\item clang version matching to the llvm version
\end{itemize}
\end{document}

